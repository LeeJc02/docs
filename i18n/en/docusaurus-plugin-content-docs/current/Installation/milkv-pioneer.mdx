---
sidebar_position: 3
---

import { DownloadLink } from "@site/src/components/ImageLinks";

# Installing RevyOS on Milk-V Pioneer

## Preparation

### Required Hardware

- MicroSD card
- MicroSD card reader
- NVMe SSD enclosure

### Download the Image

RevyOS images are hosted at [ISCAS mirror](https://mirror.iscas.ac.cn/revyos/extra/images/sg2042/).
The latest release for Milk-V Pioneer is {<DownloadLink device="Milk-V Pioneer" />}.

The following example uses the `20241230` directory:

![](/img/image-for-flash/pioneer-image-dir.png)

RevyOS flashing consists of a firmware component and the system image itself. The relevant files are:

- **Firmware (boot chain)** — contains `zsbl`, `linuxboot`, device trees, and other boot assets. It can reside either on SPI flash or on an SD card:
  - `firmware_single_sg2042-v6.6-lts-v0p7.bin` – for SPI flash
  - `firmware_single_sg2042-v6.6-lts-v0p7.img` – for SD card
- **MCU firmware** — addresses known issues and should be updated after installing the system: <https://github.com/sophgo/mcu/releases>
- **System image** — flashes to an M.2 NVMe SSD:
  - `revyos-pioneer-20241230-212249.img.zst`

## Flashing the Firmware

Depending on the storage target, choose one of the following procedures.

### Flash the Firmware to an SD Card

*Host environment: Ubuntu 22.04*

#### Using BalenaEtcher

1. Select `firmware_single_sg2042-v6.6-lts-v0p7.img`.
2. Choose the target SD card.
3. Click **Flash**.

#### Using the Command Line

Insert the SD card, confirm its device path, and run:

```shell
sudo dd if=firmware_single_sg2042-v6.6-lts-v0p7.img of=/dev/sdX bs=4M status=progress
```

Replace `/dev/sdX` with the actual device node. After flashing, execute `sync` to flush the write cache.

### Flash the Firmware to SPI Flash

*Host environment: RevyOS 20241230*

:::note
For the first installation we recommend storing the firmware on the SD card.
:::

Install the required utilities and load the kernel module:

```shell
sudo apt install mtd-utils
sudo modprobe mtdblock
```

Download the firmware:

```shell
wget https://mirror.iscas.ac.cn/revyos/extra/images/sg2042/20241230/firmware_single_sg2042-v6.6-lts-v0p7.bin
```

Then flash it into `/dev/mtd1`:

```shell
sudo flashcp -v firmware_single_sg2042-v6.6-lts-v0p7.bin /dev/mtd1
```

The SPI flash update is now complete.

## Flashing the System Image

*Host environment: Ubuntu 22.04*

First decompress the archived image:

```shell
unzstd revyos-pioneer-20241230-212249.img.zst
```

This produces `revyos-pioneer-20241230-212249.img`.

Insert the NVMe SSD into the enclosure, connect it to the host, confirm the device path, and write the image:

```shell
sudo dd if=revyos-pioneer-20241230-212249.img of=/dev/nvme0n1 bs=4M status=progress
```

Adjust `/dev/nvme0n1` to match your environment. Run `sync` when the transfer finishes to ensure the data is fully written.

## Updating the MCU Firmware

After flashing the system and booting into RevyOS, update the MCU firmware.

Install prerequisites, create a working directory, and download the utility and firmware:

```shell
sudo apt update
sudo apt install -y wget
mkdir mcu && cd mcu
wget https://github.com/sophgo/mcu/releases/download/2025.01.20/mcu-util-riscv64
# For Milk-V Pioneer; choose the correct binary for other boards from the release page.
wget https://github.com/sophgo/mcu/releases/download/2025.01.20/sg2042evb-mcu-v8-2025-01-20-10-21-22.bin
```

Load the `i2c-dev` kernel module and perform the upgrade:

```shell
sudo modprobe i2c-dev
chmod +x mcu-util-riscv64
sudo ./mcu-util-riscv64 upgrade-full 1 0x17 sg2042evb-mcu-v8-2025-01-20-10-21-22.bin
```

Typical output appears as:

```log
erase page 0000e000
program flash 00010000 100%
read flash 00010000 100%
verify flash data ok
```

After the upgrade, power the machine off and disconnect it from mains power. Leave it off for one to five minutes before powering on again.
